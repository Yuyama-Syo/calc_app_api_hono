# API Mapping Table (version 0.3 / 2025-09-29T13:05:00Z UTC)

基準:
- route file: 機能ごと集約
- schema 命名: lowerCamelCase + Body/Params/QuerySchema
- error_codes: ドメインエラーコード配列
- wave: W1=Auth/User 基盤, W2=Group, W3=Expense/Settlement, W4=低優先/補助

| endpoint                              | new_route_file             | schema_name(s)                                                                 | service_fn                          | repository_fn(s)                                      | validation_gap                                                                                       | error_codes                                                                                                  | priority | wave | notes |
|---------------------------------------|----------------------------|--------------------------------------------------------------------------------|-------------------------------------|------------------------------------------------------|-------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|----------|------|-------|
| POST /auth/regist (旧 /auth/regist) | routes/auth.route.ts       | registerUserBodySchema                                                         | authService.registerUser            | userRepository.createUser, authRepository.createTokens | password policy (長さ/強度), email format, 重複確認                                                   | ["VALIDATION_ERROR","EMAIL_ALREADY_USED","INTERNAL_ERROR"]                                                   | High     | W1   | rename from /auth/regist |
| POST /auth/login                      | routes/auth.route.ts       | loginBodySchema                                                                | authService.login                   | userRepository.findByEmail, authRepository.createTokens | email format, password length, ロックアウトポリシー                                                     | ["VALIDATION_ERROR","AUTH_INVALID_CREDENTIALS","INTERNAL_ERROR"]                                            | High     | W1   | add lockout (TBD) |
| POST /auth/refresh-token              | routes/auth.route.ts       | refreshTokenBodySchema                                                         | authService.refreshTokens           | authRepository.verifyRefresh, authRepository.rotateTokens | token format, token blacklist check                                                                    | ["VALIDATION_ERROR","TOKEN_EXPIRED","TOKEN_INVALID","INTERNAL_ERROR"]                                       | High     | W1   | rotation policy TBD |
| POST /group                           | routes/group.route.ts      | createGroupBodySchema                                                          | groupService.createGroup            | groupRepository.create, groupMemberRepository.addOwner  | group name length, members array (>=1), member id format                                                | ["VALIDATION_ERROR","USER_NOT_FOUND","INTERNAL_ERROR"]                                                      | High     | W2   | ownership rules |
| PUT /group/:groupId                   | routes/group.route.ts      | updateGroupParamsSchema, updateGroupBodySchema                                 | groupService.updateGroup            | groupRepository.update                                  | groupId uuid, name optional length limit                                                                | ["VALIDATION_ERROR","GROUP_NOT_FOUND","PERMISSION_DENIED","INTERNAL_ERROR"]                                 | High     | W2   | partial update |
| GET /group                            | routes/group.route.ts      | listGroupsQuerySchema (pagination?)                                            | groupService.listGroups             | groupRepository.listByUser                               | pagination (page>=1, limit <=100)                                                                        | ["VALIDATION_ERROR","INTERNAL_ERROR"]                                                                       | High     | W2   | add paging |
| GET /group/:groupId                   | routes/group.route.ts      | getGroupParamsSchema                                                           | groupService.getGroup               | groupRepository.findById, groupMemberRepository.list     | groupId uuid                                                                                            | ["VALIDATION_ERROR","GROUP_NOT_FOUND","PERMISSION_DENIED","INTERNAL_ERROR"]                                 | High     | W2   | — |
| POST /group/:groupId/expense          | routes/expense.route.ts    | groupParamsSchema, createExpenseBodySchema                                     | expenseService.createExpense        | expenseRepository.create, groupRepository.findById      | groupId uuid, amount >0, currency code, payer & participants presence                                    | ["VALIDATION_ERROR","GROUP_NOT_FOUND","PERMISSION_DENIED","INTERNAL_ERROR"]                                 | High     | W3   | currency normalization |
| GET /group/:groupId/expense           | routes/expense.route.ts    | groupParamsSchema, listExpensesQuerySchema (pagination?)                       | expenseService.listExpenses         | expenseRepository.listByGroup                             | groupId uuid, pagination                                                                               | ["VALIDATION_ERROR","GROUP_NOT_FOUND","INTERNAL_ERROR"]                                                    | High     | W3   | add filter TBD |
| PUT /expense/:expenseId               | routes/expense.route.ts    | expenseIdParamsSchema, updateExpenseBodySchema                                 | expenseService.updateExpense        | expenseRepository.update, expenseRepository.findById     | expenseId uuid, amount >0, participants array                                                          | ["VALIDATION_ERROR","EXPENSE_NOT_FOUND","PERMISSION_DENIED","INTERNAL_ERROR"]                               | High     | W3   | partial update |
| DELETE /expense/:expenseId            | routes/expense.route.ts    | expenseIdParamsSchema                                                          | expenseService.deleteExpense        | expenseRepository.delete, expenseRepository.findById     | expenseId uuid                                                                                          | ["VALIDATION_ERROR","EXPENSE_NOT_FOUND","PERMISSION_DENIED","INTERNAL_ERROR"]                               | High     | W3   | soft delete? TBD |
| GET /group/:groupId/settlement        | routes/settlement.route.ts | groupParamsSchema, settlementQuerySchema (if options)                          | settlementService.calculate         | expenseRepository.listByGroup, groupRepository.findById  | groupId uuid, algorithm param (enum)                                                                    | ["VALIDATION_ERROR","GROUP_NOT_FOUND","SETTLEMENT_NOT_READY","INTERNAL_ERROR"]                              | High     | W3   | algorithm choice param |
| GET /user                             | routes/user.route.ts       | listUsersQuerySchema (optional filter)                                         | userService.listUsers               | userRepository.list                                       | pagination, filter (email?)                                                                            | ["VALIDATION_ERROR","INTERNAL_ERROR"]                                                                       | Medium   | W4   | restrict fields |
| GET /                                 | routes/root.route.ts       | (none)                                                                         | rootService.index                   | (none)                                                   | none                                                                                                    | ["INTERNAL_ERROR"]                                                                                        | Low      | W4   | move to /health? |

Summary:
- High: 11
- Medium: 1
- Low: 1